---
layout: single
title: "[FPGA] Segment ì œì–´"
excerpt: "Verilogë¥¼ ì‚¬ìš©í•´ FPGA ë³´ë“œì˜ 7-Segment ë””ìŠ¤í”Œë ˆì´ë¥¼ ì œì–´í•˜ëŠ” ë°©ë²•ì„ ë°°ì›ë‹ˆë‹¤. Multiplexing ê¸°ë²•ê³¼ ë²„íŠ¼ ì…ë ¥ ì²˜ë¦¬, XDC íŒŒì¼ ì„¤ì •ê¹Œì§€ ìƒì„¸íˆ ë‹¤ë£¹ë‹ˆë‹¤."
categories: 
    - FPGA
tags:
    - FPGA
    - Verilog
    - 7-Segment
    - Nexys A7
    - Hardware

header:
  teaser: /assets/images/og/fpga.png
  og_image: /assets/images/og/fpga.png

toc: true
toc_sticky: true

---

## preview  
![do_test](/assets\images\post\FPGA\2\test_preview.gif)  

## intro 
í•´ë‹¹ ê¸€ì—ì„œëŠ” Segmentì— ëŒ€í•´ ê°„ë‹¨íˆ ì•Œì•„ë³´ê³   
FPGA ë³´ë“œì—ì„œ Segmentë¥¼ ì œì–´í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ê³µìœ í•˜ê³ ì í•©ë‹ˆë‹¤.
- ğŸ’» about Code   
    Verilog, XDC ì½”ë“œëŠ” ì œ [Github í˜ì´ì§€](https://github.com/faransansj/FPGA/tree/main/Segment)ì—ì„œ í™•ì¸í•  ìˆ˜   ìˆìŠµë‹ˆë‹¤.  

    í•´ë‹¹ ì½”ë“œëŠ” Nexys A7-T100 ë³´ë“œì— ë§ê²Œ ì‘ì„±ë˜ì—ˆìœ¼ë©°   
    ë³´ë“œì— ë”°ë¼ ì½”ë“œì˜ ìˆ˜ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


## Segment 
![](/assets\images\post\FPGA\2\segment.png)
7-digit segmentëŠ” 7ê°œì˜ ë§‰ëŒ€ì™€ í•˜ë‚˜ì˜ ì ìœ¼ë¡œ êµ¬ì„±ëœ ë””ìŠ¤í”Œë ˆì´ ì…ë‹ˆë‹¤.  
ê° ë§‰ëŒ€ëŠ” A~Gë¡œ í‘œê¸°ë˜ë©° ì ì€ dpë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤. (ê·¸ë¦¼ì°¸ê³ )  
ê° ë¶€ë¶„ì„ ì¡°í•©í•´ì„œ ìˆ«ìë‚˜ ì•ŒíŒŒë²³ ë“±ì„ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Common Anode & Common Cathode 
![](/assets\images\post\FPGA\2\common_AC.png)
- **Common Anode** : ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ì˜ ì–‘ê·¹(ì• ë…¸ë“œ)ì´ ê³µí†µìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©°,  
 ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ì¼œê¸° ìœ„í•´ì„œëŠ” í•´ë‹¹ ì„¸ê·¸ë¨¼íŠ¸ì˜ ìŒê·¹(ìºì†Œë“œ)ì— LOW ì‹ í˜¸ë¥¼ ì¸ê°€í•©ë‹ˆë‹¤.   
- **Common Cathode** : ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ì˜ ìŒê·¹(ìºì†Œë“œ)ì´ ê³µí†µìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©°,   
  ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ì¼œê¸° ìœ„í•´ì„œëŠ” í•´ë‹¹ ì„¸ê·¸ë¨¼íŠ¸ì˜ ì–‘ê·¹(ì• ë…¸ë“œ)ì— HIGH ì‹ í˜¸ë¥¼ ì¸ê°€í•©ë‹ˆë‹¤. 

### Multiplexing
![](/assets\images\post\FPGA\2\7segment_multiplexing.gif)

ì—¬ëŸ¬ ê°œì˜ 7ì„¸ê·¸ë¨¼íŠ¸ ë””ìŠ¤í”Œë ˆì´ë¥¼ ì œì–´í•˜ë ¤ë©´ ê°ê°ì˜ ë””ìŠ¤í”Œë ˆì´ë§ˆë‹¤ ë³„ë„ì˜ í•€ì´ í•„ìš”í•˜ê³ , ì´ì— ë”°ë¼ ì „ë ¥ ì†Œëª¨ë„ ì¦ê°€í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŸ¬í•œ ë°©ì‹ì€ ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤.  
ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, 8ê°œì˜ ì œì–´ í•€ì„ ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ì— ê³µìœ í•˜ì—¬ ì—°ê²°í•˜ê³ , ë§¤ìš° ë¹ ë¥¸ ì†ë„ë¡œ ê° ë””ìŠ¤í”Œë ˆì´ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì¼œê³  ë„ëŠ” ë©€í‹°í”Œë ‰ì‹± ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ ë°©ì‹ì€ ëˆˆì— ë³´ì´ì§€ ì•Šì„ ë§Œí¼ ë¹ ë¥¸ ì „í™˜ ì†ë„ ë•ë¶„ì—, ë§ˆì¹˜ ì—¬ëŸ¬ ë””ìŠ¤í”Œë ˆì´ê°€ ë™ì‹œì— ìˆ«ìë¥¼ í‘œì‹œí•˜ê³  ìˆëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ í•´ì¤ë‹ˆë‹¤.    

## Implement 
### Hardware
[Nexys A7 ë ˆí¼ëŸ°ìŠ¤](https://digilent.com/reference/_media/reference/programmable-logic/nexys-a7/nexys-a7_rm.pdf)ë¥¼ í™•ì¸í•´ ë³´ë©´ Nexys A7-T100 ë³´ë“œì— í¬í•¨ëœ ì„¸ê·¸ë¨¼íŠ¸ëŠ” common anode ë°©ì‹ì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì„¸ê·¸ë¨¼íŠ¸ ì œì–´ë¥¼ ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ í•€ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.  
    - AN[7:0]: 8ê°œì˜ ë””ì§€íŠ¸(ìë¦¿ìˆ˜) ì„ íƒ í•€  
    - CA, CB, CC, CD, CE, CF, CG: ê° ì„¸ê·¸ë¨¼íŠ¸(A-G) ì œì–´ í•€  
    - DP: ì†Œìˆ˜ì  ì œì–´ í•€  

### Verilog coding 
ì„¸ê·¸ë¨¼íŠ¸ ì œì–´ë¥¼ ìœ„í•œ Verilog ëª¨ë“ˆì˜ ê¸°ë³¸ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```v
module seven_segment_controller (
  input wire clk,
  input wire [4:0] buttons,
  output reg [7:0] segment_display,
  output reg [7:0] digit_enable
);
  // êµ¬í˜„ ì½”ë“œ
endmodule
```
### ì£¼ìš” ê¸°ëŠ¥ êµ¬í˜„
1. ë””ì§€íŠ¸ ê°’ ì €ì¥: 8ê°œì˜ ë””ì§€íŠ¸ì— ëŒ€í•œ ê°’ì„ ì €ì¥í•  ë ˆì§€ìŠ¤í„° ë°°ì—´ì„ ì„ ì–¸í•©ë‹ˆë‹¤.
2. ë²„íŠ¼ ì…ë ¥ ì²˜ë¦¬: ë²„íŠ¼ ì…ë ¥ì„ ê°ì§€í•˜ê³  ë””ë°”ìš´ì‹± ì²˜ë¦¬ë¥¼ í•©ë‹ˆë‹¤. ë²„íŠ¼ì— ë”°ë¼ ë””ì§€íŠ¸ ì„ íƒ, ê°’ ë³€ê²½, í¸ì§‘ ëª¨ë“œ ì „í™˜ ë“±ì˜ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.
3. ë©€í‹°í”Œë ‰ì‹± ë¡œì§: ê³ ì†ìœ¼ë¡œ ë””ì§€íŠ¸ë¥¼ ì „í™˜í•˜ì—¬ ëª¨ë“  ë””ì§€íŠ¸ê°€ ë™ì‹œì— ì¼œì§„ ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ í•©ë‹ˆë‹¤.
4. 7-ì„¸ê·¸ë¨¼íŠ¸ ë³€í™˜: ìˆ«ìë¥¼ 7-ì„¸ê·¸ë¨¼íŠ¸ íŒ¨í„´ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

```v
reg [3:0] digit_value [7:0];
```

```v
always @(posedge clk) begin
  if (counter[15:0] == 16'hFFFF) begin
    display_digit <= display_digit + 1;
    digit_enable <= ~(1 << display_digit);
    // ì„¸ê·¸ë¨¼íŠ¸ ê°’ ì„¤ì • ë¡œì§
  end
end
```

```v
function [7:0] digit_to_7segment;
  input [3:0] digit;
  case (digit)
    4'd0: digit_to_7segment = 8'b11000000; // 0
    4'd1: digit_to_7segment = 8'b11111001; // 1
    // ... ë‹¤ë¥¸ ìˆ«ìë“¤ ...
    default: digit_to_7segment = 8'b11111111; // blank
  endcase
endfunction
```
### XDC íŒŒì¼ ì„¤ì •
ë³´ë“œì˜ í•€ ë§¤í•‘ì„ ìœ„í•´ XDCë¥¼ ì‘ì„±í•´ ì¤ë‹ˆë‹¤.  
ë˜í¼ëŸ°ìŠ¤ ë©”ë‰´ì–¼ 9 Basic I/Oí•­ëª©ì„ ë³´ë©´ ì„¸ê·¸ë¨¼íŠ¸ëŠ” 3.3Vë¡œ ë™ì‘í•˜ê³  ê°ê°ì˜ í•€ì˜ ë²ˆí˜¸ê°€ ëª…ì‹œë˜ì–´ ìˆìœ¼ë‹ˆ ì°¸ê³ í•˜ë©´ ë˜ê² ìŠµë‹ˆë‹¤. 





## Code
<details>
<summary>main.v</summary>
<div markdown="1">
```v
module seven_segment_controller (
  input wire clk,
  input wire [4:0] buttons, // BTNL, BTNR, BTNU, BTND, BTNC
  output reg [7:0] segment_display, // 7-segment display output
  output reg [7:0] digit_enable // enable specific digit
);
  reg [3:0] digit_value [7:0]; // Values for each of the 8 digits
  reg [2:0] current_digit = 0; // Pointer to the current digit (0 to 7)
  reg [22:0] counter = 0; // Counter for button debouncing and display multiplexing
  reg [4:0] prev_buttons = 0; // Previous button state for edge detection
  reg edit_mode = 0; // Toggle for edit mode
  reg blink_state = 0; // Blink state for the current digit
  // Button logic for navigating and editing
  always @(posedge clk) begin
    counter <= counter + 1;
    // Debounce and edge detection
    if (counter == 23'h7FFFFF) begin
      // Move left/right to select digit
      if (buttons[0] && !prev_buttons[0]) // BTNL
        current_digit <= (current_digit == 0) ? 7 : current_digit - 1;
      else if (buttons[1] && !prev_buttons[1]) // BTNR
        current_digit <= (current_digit == 7) ? 0 : current_digit + 1;
      // Toggle edit mode
      if (buttons[4] && !prev_buttons[4]) // BTNC
        edit_mode <= ~edit_mode;
      // Increment/decrement selected digit value in edit mode
      if (edit_mode) begin
        if (buttons[2] && !prev_buttons[2]) // BTNU
          digit_value[current_digit] <= (digit_value[current_digit] == 9) ? 0 : digit_value[current_digit] + 1;
        else if (buttons[3] && !prev_buttons[3]) // BTND
          digit_value[current_digit] <= (digit_value[current_digit] == 0) ? 9 : digit_value[current_digit] - 1;
      end
      // Store button states for next cycle
      prev_buttons <= buttons;
    end
    // Blink logic (toggle every ~0.5 seconds)
    if (counter[21:0] == 22'h3FFFFF) begin
      blink_state <= ~blink_state;
    end
  end
  // 7-segment multiplexing logic
  reg [2:0] display_digit = 0;
  always @(posedge clk) begin
    if (counter[15:0] == 16'hFFFF) begin
      display_digit <= display_digit + 1;
      // Enable only the current display digit
      digit_enable <= ~(1 << display_digit);      
      // Display logic
      if (display_digit == current_digit && !edit_mode && !blink_state)
        segment_display <= 8'b11111111; // Turn off the current digit for blinking
      else
        segment_display <= digit_to_7segment(digit_value[display_digit]);
    end
  end
  // Function to convert a digit (0-9) to the 7-segment display pattern
  function [7:0] digit_to_7segment;
    input [3:0] digit;
    case (digit)
      4'd0: digit_to_7segment = 8'b11000000; // 0
      4'd1: digit_to_7segment = 8'b11111001; // 1
      4'd2: digit_to_7segment = 8'b10100100; // 2
      4'd3: digit_to_7segment = 8'b10110000; // 3
      4'd4: digit_to_7segment = 8'b10011001; // 4
      4'd5: digit_to_7segment = 8'b10010010; // 5
      4'd6: digit_to_7segment = 8'b10000010; // 6
      4'd7: digit_to_7segment = 8'b11111000; // 7
      4'd8: digit_to_7segment = 8'b10000000; // 8
      4'd9: digit_to_7segment = 8'b10010000; // 9
      default: digit_to_7segment = 8'b11111111; // blank
    endcase
  endfunction
endmodule
```
</div>
</details>

<details>
<summary>main.xdc</summary>
<div markdown="1">
```xdc
# Clock (clk)
set_property PACKAGE_PIN E3 [get_ports {clk}]
set_property IOSTANDARD LVCMOS33 [get_ports {clk}]

# Buttons (BTNL, BTNR, BTNU, BTND, BTNC)
set_property PACKAGE_PIN P17 [get_ports {buttons[0]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {buttons[0]}]

set_property PACKAGE_PIN M17 [get_ports {buttons[1]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {buttons[1]}]

set_property PACKAGE_PIN M18 [get_ports {buttons[2]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {buttons[2]}]

set_property PACKAGE_PIN P18 [get_ports {buttons[3]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {buttons[3]}]

set_property PACKAGE_PIN N17 [get_ports {buttons[4]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {buttons[4]}]

# Seven Segment Display (segment_display[0] ~ segment_display[7])
set_property PACKAGE_PIN T10 [get_ports {segment_display[0]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {segment_display[0]}]

set_property PACKAGE_PIN R10 [get_ports {segment_display[1]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {segment_display[1]}]

set_property PACKAGE_PIN K16 [get_ports {segment_display[2]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {segment_display[2]}]

set_property PACKAGE_PIN K13 [get_ports {segment_display[3]}]   
set_property IOSTANDARD LVCMOS33 [get_ports {segment_display[3]}]

set_property PACKAGE_PIN P15 [get_ports {segment_display[4]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {segment_display[4]}]

set_property PACKAGE_PIN T11 [get_ports {segment_display[5]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {segment_display[5]}]

set_property PACKAGE_PIN L18 [get_ports {segment_display[6]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {segment_display[6]}]

set_property PACKAGE_PIN H15 [get_ports {segment_display[7]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {segment_display[7]}]

# Digit Enable (digit_enable[0] ~ digit_enable[7])

set_property PACKAGE_PIN U13 [get_ports {digit_enable[0]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {digit_enable[0]}]

set_property PACKAGE_PIN K2 [get_ports {digit_enable[1]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {digit_enable[1]}]

set_property PACKAGE_PIN T14 [get_ports {digit_enable[2]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {digit_enable[2]}]

set_property PACKAGE_PIN P14 [get_ports {digit_enable[3]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {digit_enable[3]}]

set_property PACKAGE_PIN J14 [get_ports {digit_enable[4]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {digit_enable[4]}]

set_property PACKAGE_PIN T9 [get_ports {digit_enable[5]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {digit_enable[5]}]

set_property PACKAGE_PIN J18 [get_ports {digit_enable[6]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {digit_enable[6]}]

set_property PACKAGE_PIN J17 [get_ports {digit_enable[7]}]  
set_property IOSTANDARD LVCMOS33 [get_ports {digit_enable[7]}]
```

</div>
</details>

### Code Review 
- **ì£¼ìš” íŠ¹ì§•ê³¼ ê¸°ëŠ¥**  
    1) 8ìë¦¬ 7-ì„¸ê·¸ë¨¼íŠ¸ ë””ìŠ¤í”Œë ˆì´ ì œì–´  
    2) 5ê°œì˜ ë²„íŠ¼ ì…ë ¥ì„ ì‚¬ìš©í•˜ì—¬ ë””ìŠ¤í”Œë ˆì´ë¥¼ ì¡°ì‘  
    3) í¸ì§‘ ëª¨ë“œì™€ ì¼ë°˜ ëª¨ë“œ ì§€ì›  
    4) ë””ìŠ¤í”Œë ˆì´ ë©€í‹°í”Œë ‰ì‹± êµ¬í˜„í•˜ì—¬ 8ìë¦¬ë¥¼ ë™ì‹œì— ì œì–´  
- **Code structure**  
    - ëª¨ë“ˆ ì •ì˜  
        ì…ë ¥: í´ëŸ­, 5ê°œ ë²„íŠ¼  
        ì¶œë ¥: 7-ì„¸ê·¸ë¨¼íŠ¸ ë””ìŠ¤í”Œë ˆì´ ì¶œë ¥, ìë¦¿ìˆ˜ í™œì„±í™” ì‹ í˜¸  

    - ë ˆì§€ìŠ¤í„° ì •ì˜  
        ê° ìë¦¿ìˆ˜ì˜ ê°’, í˜„ì¬ ì„ íƒëœ ìë¦¿ìˆ˜, ì¹´ìš´í„°, ì´ì „ ë²„íŠ¼ ìƒíƒœ ë“±  


    - ë²„íŠ¼ ë¡œì§  
        ë””ë°”ìš´ì‹±ì„ ìœ„í•œ ì¹´ìš´í„° ì‚¬ìš©  
        ì¢Œ/ìš° ë²„íŠ¼ìœ¼ë¡œ ìë¦¿ìˆ˜ ì„ íƒ  
        ì¤‘ì•™ ë²„íŠ¼ìœ¼ë¡œ í¸ì§‘ ëª¨ë“œ ì „í™˜  
        ìœ„/ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì„ íƒëœ ìë¦¿ìˆ˜ ê°’ ë³€ê²½    


    - ë¸”ë§í‚¹ ë¡œì§  
        ì•½ 0.5ì´ˆ ê°„ê²©ìœ¼ë¡œ ì„ íƒëœ ìë¦¿ìˆ˜ ê¹œë¹¡ì„  


    - ë””ìŠ¤í”Œë ˆì´ ë©€í‹°í”Œë ‰ì‹±  
        ê³ ì†ìœ¼ë¡œ ê° ìë¦¿ìˆ˜ë¥¼ ìˆœí™˜í•˜ë©° í‘œì‹œ  
        í˜„ì¬ í™œì„±í™”ëœ ìë¦¿ìˆ˜ë§Œ ì¼œì§  

    - 7-ì„¸ê·¸ë¨¼íŠ¸ ë³€í™˜ í•¨ìˆ˜    
        0-9 ìˆ«ìë¥¼ 7-ì„¸ê·¸ë¨¼íŠ¸ íŒ¨í„´ìœ¼ë¡œ ë³€í™˜  

