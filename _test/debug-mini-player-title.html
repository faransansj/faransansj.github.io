<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¸ë‹ˆí”Œë ˆì´ì–´ ì œëª© ë””ë²„ê¹…</title>
    <link rel="stylesheet" href="/assets/css/persistent-audio-player.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-panel {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-info {
            background: #f0f8ff;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #007acc;
            border-radius: 4px;
        }
        .debug-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        .debug-button:hover {
            background: #005a9e;
        }
        .error {
            color: #d32f2f;
            background: #ffebee;
            border-left: 4px solid #d32f2f;
        }
        .success {
            color: #2e7d32;
            background: #e8f5e8;
            border-left: 4px solid #2e7d32;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="debug-panel">
        <h1>ğŸ”§ ë¯¸ë‹ˆí”Œë ˆì´ì–´ ì œëª© ë””ë²„ê¹…</h1>

        <div class="debug-info">
            <h3>ë””ë²„ê¹… ëª©í‘œ</h3>
            <p>ë¯¸ë‹ˆí”Œë ˆì´ì–´ì—ì„œ ìŒì•… ì œëª©ì´ í‘œì‹œë˜ì§€ ì•ŠëŠ” ë¬¸ì œë¥¼ ì§„ë‹¨í•˜ê³  í•´ê²°í•©ë‹ˆë‹¤.</p>
        </div>

        <div class="debug-info">
            <h3>í…ŒìŠ¤íŠ¸ ì œì–´</h3>
            <button class="debug-button" onclick="checkPlayerExists()">í”Œë ˆì´ì–´ ì¡´ì¬ í™•ì¸</button>
            <button class="debug-button" onclick="checkTitleElement()">ì œëª© ìš”ì†Œ í™•ì¸</button>
            <button class="debug-button" onclick="checkTrackData()">íŠ¸ë™ ë°ì´í„° í™•ì¸</button>
            <button class="debug-button" onclick="loadTestTrack()">í…ŒìŠ¤íŠ¸ íŠ¸ë™ ë¡œë“œ</button>
            <button class="debug-button" onclick="updateTitleManually()">ìˆ˜ë™ ì œëª© ì—…ë°ì´íŠ¸</button>
            <button class="debug-button" onclick="checkAllStates()">ì „ì²´ ìƒíƒœ í™•ì¸</button>
        </div>

        <div id="debugOutput" class="debug-info">
            <h3>ë””ë²„ê·¸ ì¶œë ¥</h3>
            <pre id="outputContent">ì¤€ë¹„ë¨... í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</pre>
        </div>

        <div class="debug-info">
            <h3>ì˜ˆìƒ ë¬¸ì œ ë° í•´ê²°ì±…</h3>
            <ul>
                <li><strong>DOM ìš”ì†Œ ëˆ„ë½:</strong> #persistentTitle ìš”ì†Œê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ</li>
                <li><strong>íƒ€ì´ë° ì´ìŠˆ:</strong> íŠ¸ë™ ë¡œë“œ ì „ì— DOM ì—…ë°ì´íŠ¸ ì‹œë„</li>
                <li><strong>ë°ì´í„° ë°”ì¸ë”©:</strong> currentTrack ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì§€ ì•ŠìŒ</li>
                <li><strong>CSS ìˆ¨ê¹€:</strong> ìŠ¤íƒ€ì¼ë¡œ ì¸í•´ ì œëª©ì´ ë³´ì´ì§€ ì•ŠìŒ</li>
            </ul>
        </div>
    </div>

    <script src="/assets/js/persistent-audio-player.js"></script>
    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('outputContent');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            output.textContent += '\n' + logEntry;

            const panel = document.getElementById('debugOutput');
            if (type === 'error') {
                panel.className = 'debug-info error';
            } else if (type === 'success') {
                panel.className = 'debug-info success';
            } else {
                panel.className = 'debug-info';
            }

            console.log(logEntry);
        }

        function clearLog() {
            document.getElementById('outputContent').textContent = '';
            document.getElementById('debugOutput').className = 'debug-info';
        }

        function checkPlayerExists() {
            clearLog();
            log('=== í”Œë ˆì´ì–´ ì¡´ì¬ í™•ì¸ ===');

            const globalPlayer = window.persistentAudioPlayer;
            log(`window.persistentAudioPlayer: ${!!globalPlayer}`);

            if (globalPlayer) {
                log(`í”Œë ˆì´ì–´ ì´ˆê¸°í™”ë¨: ${globalPlayer.isInitialized}`);
                log(`ë¯¸ë‹ˆí”Œë ˆì´ì–´ ìš”ì†Œ: ${!!globalPlayer.miniPlayerElement}`);
                log(`currentTrack: ${!!globalPlayer.currentTrack}`, 'success');
            } else {
                log('í”Œë ˆì´ì–´ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!', 'error');
            }
        }

        function checkTitleElement() {
            clearLog();
            log('=== ì œëª© ìš”ì†Œ í™•ì¸ ===');

            const titleElement = document.querySelector('#persistentTitle');
            log(`DOM querySelector('#persistentTitle'): ${!!titleElement}`);

            if (titleElement) {
                log(`ì œëª© í…ìŠ¤íŠ¸: "${titleElement.textContent}"`);
                log(`ìš”ì†Œ ìŠ¤íƒ€ì¼: visible=${titleElement.offsetWidth > 0 && titleElement.offsetHeight > 0}`);
                log(`computed style: ${getComputedStyle(titleElement).display}`, 'success');
            } else {
                log('ì œëª© ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'error');

                // ë¯¸ë‹ˆí”Œë ˆì´ì–´ ì „ì²´ í™•ì¸
                const miniPlayer = document.querySelector('#persistent-mini-player');
                log(`ë¯¸ë‹ˆí”Œë ˆì´ì–´ ìš”ì†Œ: ${!!miniPlayer}`);

                if (miniPlayer) {
                    log(`ë¯¸ë‹ˆí”Œë ˆì´ì–´ HTML: ${miniPlayer.innerHTML.substring(0, 200)}...`);
                }
            }
        }

        function checkTrackData() {
            clearLog();
            log('=== íŠ¸ë™ ë°ì´í„° í™•ì¸ ===');

            const player = window.persistentAudioPlayer;
            if (player) {
                log(`currentTrack: ${JSON.stringify(player.currentTrack, null, 2)}`);
                log(`isPlaying: ${player.isPlaying}`);
                log(`currentTime: ${player.currentTime}`);
                log(`duration: ${player.duration}`, 'success');
            } else {
                log('í”Œë ˆì´ì–´ ì¸ìŠ¤í„´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤!', 'error');
            }
        }

        function loadTestTrack() {
            clearLog();
            log('=== í…ŒìŠ¤íŠ¸ íŠ¸ë™ ë¡œë“œ ===');

            const player = window.persistentAudioPlayer;
            if (player) {
                const testTrack = {
                    src: '/assets/audio/STUDY_WITH_MIKU-part3.mp3',
                    title: 'ğŸµ ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸ íŠ¸ë™'
                };

                log(`í…ŒìŠ¤íŠ¸ íŠ¸ë™ ë¡œë”©: ${testTrack.title}`);
                player.loadTrack(testTrack, false)
                    .then(() => {
                        log('íŠ¸ë™ ë¡œë“œ ì„±ê³µ!', 'success');
                        setTimeout(() => {
                            checkTitleElement();
                        }, 1000);
                    })
                    .catch(error => {
                        log(`íŠ¸ë™ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`, 'error');
                    });
            } else {
                log('í”Œë ˆì´ì–´ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!', 'error');
            }
        }

        function updateTitleManually() {
            clearLog();
            log('=== ìˆ˜ë™ ì œëª© ì—…ë°ì´íŠ¸ ===');

            const player = window.persistentAudioPlayer;
            const titleElement = document.querySelector('#persistentTitle');

            if (player && titleElement) {
                const testTitle = 'ğŸ”§ ìˆ˜ë™ ì—…ë°ì´íŠ¸ëœ ì œëª©';
                titleElement.textContent = testTitle;
                log(`ìˆ˜ë™ìœ¼ë¡œ ì œëª© ì—…ë°ì´íŠ¸: "${testTitle}"`, 'success');

                // í”Œë ˆì´ì–´ì˜ updateMiniPlayerInfoë„ í˜¸ì¶œ
                if (player.currentTrack) {
                    player.currentTrack.title = testTitle;
                    player.updateMiniPlayerInfo();
                    log('í”Œë ˆì´ì–´ updateMiniPlayerInfo() í˜¸ì¶œë¨');
                }
            } else {
                log(`í”Œë ˆì´ì–´: ${!!player}, ì œëª©ìš”ì†Œ: ${!!titleElement}`, 'error');
            }
        }

        function checkAllStates() {
            clearLog();
            log('=== ì „ì²´ ìƒíƒœ ì ê²€ ===');

            // 1. í”Œë ˆì´ì–´ ìƒíƒœ
            const player = window.persistentAudioPlayer;
            log(`1. í”Œë ˆì´ì–´ ì¡´ì¬: ${!!player}`);

            // 2. DOM ìƒíƒœ
            const miniPlayer = document.querySelector('#persistent-mini-player');
            const titleElement = document.querySelector('#persistentTitle');
            log(`2. ë¯¸ë‹ˆí”Œë ˆì´ì–´ DOM: ${!!miniPlayer}`);
            log(`3. ì œëª© ìš”ì†Œ DOM: ${!!titleElement}`);

            // 3. ë°ì´í„° ìƒíƒœ
            if (player) {
                log(`4. currentTrack: ${!!player.currentTrack}`);
                if (player.currentTrack) {
                    log(`5. íŠ¸ë™ ì œëª©: "${player.currentTrack.title}"`);
                }
            }

            // 4. CSS ìƒíƒœ
            if (titleElement) {
                const styles = getComputedStyle(titleElement);
                log(`6. CSS display: ${styles.display}`);
                log(`7. CSS visibility: ${styles.visibility}`);
                log(`8. CSS fontSize: ${styles.fontSize}`);
                log(`9. CSS color: ${styles.color}`);
                log(`10. ì‹¤ì œ í¬ê¸°: ${titleElement.offsetWidth}x${titleElement.offsetHeight}`);
            }

            log('=== ì „ì²´ ì ê²€ ì™„ë£Œ ===', 'success');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í™•ì¸
        window.addEventListener('load', function() {
            setTimeout(() => {
                log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ìë™ ì ê²€ ì‹œì‘');
                checkAllStates();
            }, 2000);
        });
    </script>
</body>
</html>